<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>BDS Modding Bible</title>
        <meta name="robots" content="noindex">


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->


        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="toc.js"></script>
    </head>
    <body>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">BDS Modding Bible</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="windows-bds-modding-through-dll-injection"><a class="header" href="#windows-bds-modding-through-dll-injection">Windows BDS Modding Through DLL Injection</a></h1>
<hr />
<p>TODO</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="introduction"><a class="header" href="#introduction">Introduction</a></h1>
<hr />
<p><em>Enter <strong>1.6</strong>: the first version of <a href="https://www.minecraft.net/en-us/about-bedrock">Minecraft Bedrock Edition (MCBE)</a> to have an official server software. Before that, the only option for server hosting was using custom server software such as <a href="https://github.com/CloudburstMC/Nukkit">Nukkit</a> and <a href="https://pmmp.io/">PocketMine-MP</a> (written in Java and PHP respectively). These two, and many others, are still used today due to their deep modding support, even though they lack many vanilla features, and the mechanics are so different that playing on them feels like a completely different game.</em></p>
<p>The <strong>Bedrock Dedicated Server (BDS)</strong> was (regarding performance and quick update schedule) a big improvement over these two. However, Mojang has not yet added modding support, which is a big limitation for large networks and, as I said previously, the main reason why people still use custom MCBE server software.</p>
<p>BDS is also closed-source, but being in its alpha version, the debug information (bedrock_server.pdb file in Windows) is included along with the executable and resources. This file makes reverse engineering (and subsequently modifying) BDS a lot easier. Disassemblers and decompilers (we’ll see what these are later) can get a lot of information (such as function names and some data types) just by extracting its contents.</p>
<p>This is good enough to code BDS mods using <strong>function hooking</strong> (you will learn what this is later) as <a href="https://learn.microsoft.com/en-us/windows/win32/dlls/dynamic-link-library-functions">Dynamic Link Libraries (DLLs)</a>, which can then be loaded into the running BDS process. A Chinese tech player who goes by <code>[Player]</code> (actual name) wrote a guide on how to do this. However, it's nowadays slightly outdated, having been made in <strong>1.13</strong>, which is the main reason I decided to write this. So, consider this an updated version of the original so-called “<a href="https://github.com/">DLL Modding Bible</a>”!</p>
<hr />
<div class="footnote-definition" id="1"><sup class="footnote-definition-label">1</sup>
<p>Reverse engineering is basically taking apart something of which the inner workings are mostly unknown, and putting it back together to learn how it works.</p>
</div>
<div class="footnote-definition" id="2"><sup class="footnote-definition-label">2</sup>
<p>It’s still worth noting that, as Mojang relies more and more on compiler optimization to improve performance, code readability has and will keep worsening.</p>
</div>
<div style="break-before: page; page-break-before: always;"></div><h1 id="terminology"><a class="header" href="#terminology">Terminology</a></h1>
<hr />
<p>Before we get right into code digging and modding, here are some terms you should be familiar with:</p>
<ul>
<li>
<p><strong>Disassembler</strong>: Takes an executable (.exe) file as input and produces assembly code. Tools like <a href="https://hex-rays.com/ida-pro/">IDA Pro</a> or <a href="https://ghidra-sre.org/">Ghidra</a> are commonly used.</p>
</li>
<li>
<p><strong>Decompiler</strong>: Takes machine code (assembly) as an input and produces C-style pseudocode. For example, the decompiler in <a href="https://ghidra-sre.org/">Ghidra</a> or the <a href="https://hex-rays.com/">Hex-Rays Decompiler</a> for IDA.</p>
</li>
<li>
<p><strong>PDB</strong>: Program Database, contains the debug information. Learn more about <a href="https://learn.microsoft.com/en-us/windows/win32/debug/using-symbols">PDB files</a>.</p>
</li>
<li>
<p><strong>DLL</strong>: Dynamic Link Library, code loaded at runtime. DLLs are widely used for modular development and runtime extensions in Windows.</p>
</li>
<li>
<p><strong>IDA</strong>: Interactive Disassembler, a reverse engineering program and environment. <a href="https://hex-rays.com/ida-pro/">IDA Pro</a> is the most popular version, offering a wide range of tools for disassembly and debugging.</p>
</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="requirements"><a class="header" href="#requirements">Requirements</a></h1>
<hr />
<h2 id="64-bit-computer-or-virtual-machine-with-adequate-ram"><a class="header" href="#64-bit-computer-or-virtual-machine-with-adequate-ram"><strong>64-bit Computer or Virtual Machine with Adequate RAM</strong></a></h2>
<ul>
<li>
<p><strong>64-bit Architecture</strong>: BDS is only available for 64-bit processors; thus, a 64-bit machine is necessary.</p>
</li>
<li>
<p><strong>RAM</strong>: A minimum of 6GB of RAM is recommended, as most reverse engineering tools are resource-intensive. Additionally, recent updates have led to decreased performance in both the server and client of MCBE.</p>
</li>
</ul>
<hr />
<h2 id="bedrock-dedicated-server-bds"><a class="header" href="#bedrock-dedicated-server-bds"><strong>Bedrock Dedicated Server (BDS)</strong></a></h2>
<p>BDS, which you can download <a href="https://www.minecraft.net/en-us/download/server/bedrock">here</a>, is written in C++. This guide assumes the reader has a solid understanding of C++. There are versions available for both Windows and Ubuntu, compiled from the same source code. Although disassembling the Ubuntu BDS can be time-consuming (approximately a day with IDA on a 10th gen i5 and 8GB RAM), having both versions is beneficial.</p>
<h4 id="ubuntu-version"><a class="header" href="#ubuntu-version"><strong>Ubuntu Version</strong>:</a></h4>
<ul>
<li>
<p>Lacks a debug information file; all symbols are directly included in the binary, making analysis slower since the disassembler needs to analyze the file twice.</p>
</li>
<li>
<p>Has minimal compiler optimization (at least in pre-1.16.200 versions).</p>
</li>
<li>
<p>Exhibits worse performance than its Windows counterpart (though this isn't an issue for this guide).</p>
</li>
<li>
<p>Produces more readable decompiler output and reveals functions that might have been optimized away by the compiler in the Windows version.</p>
</li>
</ul>
<h4 id="windows-version"><a class="header" href="#windows-version"><strong>Windows Version</strong>:</a></h4>
<ul>
<li>
<p>Includes a PDB file, allowing the disassembler to extract symbol information directly, speeding up analysis.</p>
</li>
<li>
<p>Due to higher compiler optimization, it performs better than the Ubuntu version, but the pseudocode produced by decompilers (Hex-Rays, Ghidra, Snowman, JSDEC) is less readable.</p>
</li>
</ul>
<p>It's recommended to have disassemblies of:</p>
<ul>
<li>
<p>1.14.60 Ubuntu</p>
</li>
<li>
<p>1.18.0 Windows BDS (notably readable code)</p>
</li>
<li>
<p>The latest version of Windows BDS</p>
</li>
</ul>
<p>Earlier versions like 1.6 can aid in easier type reconstruction, but with the creation of this guide, they aren't strictly necessary.</p>
<hr />
<h2 id="mcbe-client"><a class="header" href="#mcbe-client"><strong>MCBE Client</strong></a></h2>
<p>Using the Windows 10 client is advisable, as it facilitates testing mods on the same device. By default, the Windows 10 client disables applications from accessing the local network loopback address. To access a locally hosted BDS, you must enable loopback. Microsoft's documentation provides detailed instructions on <a href="https://learn.microsoft.com/en-us/troubleshoot/windows-server/networking/install-microsoft-loopback-adapter">installing the Microsoft Loopback Adapter</a>.</p>
<hr />
<h2 id="visual-studio"><a class="header" href="#visual-studio"><strong>Visual Studio</strong></a></h2>
<p>Visual Studio (VS) is an Integrated Development Environment (IDE) by Microsoft, primarily used for C/C++, C#, and JavaScript. It's required since the DLL mod template is a VS project. The initial chapters of <a href="https://www.learncpp.com/">learncpp</a> explain how to install VS.</p>
<p><strong>Disassembler &amp; Decompiler</strong></p>
<p>A disassembler (and preferably a decompiler) is essential for reverse engineering BDS. The two most popular tools are:</p>
<ul>
<li>
<p><strong>Ghidra</strong>: Developed by the NSA, it's open-source.</p>
</li>
<li>
<p><strong>IDA Pro</strong>: Developed by Hex-Rays, it's not free but is significantly faster than Ghidra. As of IDA 8, the freeware version includes a decompiler, which should suffice for most modding tasks.</p>
</li>
</ul>
<p>Ghidra is at version 11.0.2 at the time of writing. While IDA remains the industry standard due to its speed and maturity, Ghidra's decompiler is improving rapidly and may surpass IDA after a few major updates.</p>
<hr />
<h2 id="pdb-dumper"><a class="header" href="#pdb-dumper"><strong>PDB Dumper</strong></a></h2>
<p>To hook into internal BDS functions, you need the Relative Virtual Address (RVA) of those functions. An RVA is the memory address of a function or constant minus the base address where the process module is loaded. You can obtain RVAs from the PDB file using a PDB dumper. Options include:</p>
<ul>
<li>
<p>A custom tool I've developed (which will be used in this guide).</p>
</li>
<li>
<p><a href="https://github.com/codehz/eatpdb">EatPdb by codehz</a>.</p>
</li>
<li>
<p><a href="https://github.com/AgNO3/TrDevHelper">TrDevHelper by AgNO3</a>, designed to aid in the development of TrapDoor, a carpet mod-like BDS plugin.</p>
</li>
</ul>
<p>Alternatively, you can create your own. The <a href="https://github.com/Microsoft/microsoft-pdb">microsoft-pdb repo</a> contains information on the PDB file format; you can refer to <code>cvdump</code> for inspiration.</p>
<hr />
<h2 id="dll-injector"><a class="header" href="#dll-injector"><strong>DLL Injector</strong></a></h2>
<p>Since Mojang hasn't added modding support to BDS or the MCBE client, the BDS process itself must be modified when loaded into memory. Dynamic Link Libraries (DLLs) are used for this purpose, and an 'injector' is required to load them into the BDS process. The bedrock server modding community often uses <a href="https://github.com/DarthTon/Xenos">Xenos</a>, but since Windows Defender may flag it upon download and it might be challenging for some users, you can opt for a simpler injector I've written. This guide will utilize Xenos.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="tools-of-the-trade"><a class="header" href="#tools-of-the-trade">Tools of the Trade</a></h1>
<hr />
<h2 id="visual-studio-1"><a class="header" href="#visual-studio-1">Visual Studio</a></h2>
<p>As I mentioned before,  <a href="https://www.learncpp.com/">learncpp</a> explains how to use Visual Studio and I expect you to have some experience with C++ (if you don't, what are you even doing here, go learn) so I will not personally go into too much detail on how to use it unless it’s necessary.</p>
<hr />
<h2 id="ida"><a class="header" href="#ida">IDA</a></h2>
<h3 id="disassembly"><a class="header" href="#disassembly">Disassembly</a></h3>
<ol>
<li>First you need to launch the 64bit IDA Pro executable. When you do so, you should see a screen similar to this:</li>
</ol>
<p><img 
	 src="img/ida_screen.png" class="center"
style="width: 150%;" /></p>
<ol start="2">
<li>Press <code>'File'</code>, then <code>‘Open’</code> and a file dialog will be opened. You can either select the windows executable or the Ubuntu binary (which you should have already downloaded and unzipped into a folder.</li>
<li>Another screen will pop up. If you are disassembling Ubuntu BDS, leave everything as default. If you're disassembling windows BDS, make sure the 'Load Resources' option is checked.</li>
<li>When analyzing windows BDS, a message box pops up asking if you want to load the PDB.</li>
<li>Choose 'Yes'. It'll fail to find it, then it'll ask to search for it on the Microsoft Symbol Server.</li>
<li>Click on 'Yes' and it'll fail again and ask to browse it on the disk.</li>
<li>Select 'Yes' and it'll open another file dialog; then select the PDB.</li>
</ol>
<p>IDA Pro has an automatic analysis phase during which the file is first loaded. The more the content and the more program files you analyze, the slower it will be. BDS analysis can take from half an hour to a day with IDA, depending on your hardware and how much memory is being used by other processes.</p>
<p>The colored bar at the top of the main screen has 2 arrows. A yellow one which indicates where your cursor is placed, and a red one which is displayed during analysis to indicate progress. Don't do anything until that red arrow has dissappeared or you see "The initial autoanalysis has been finished" on the output window at the bottom of the main window. Here's some advice: If you click on the top of the function window that will show up on the left side of the screen, it'll order the functions alphabetically. <strong>DO NOT</strong> do this while the file is being analyzed. It's likely IDA will crash.</p>
<h3 id="navigating-ida"><a class="header" href="#navigating-ida">Navigating IDA</a></h3>
<ol>
<li>The <strong>Functions Window</strong> on the left lists all functions. Use <strong>Ctrl+F</strong> to search by name.</li>
<li>Double-clicking a function opens its disassembly.</li>
<li>Press <strong>F5</strong> to view the pseudocode in a tab labeled "Pseudocode-[number]."</li>
<li>Open the <strong>Local Types Window</strong> with <strong>Shift+F1</strong> to view structs, enums, unions, etc. Right-click on a type to edit and see its declaration.</li>
<li>For specific values (e.g., minimum spacing between ocean monuments), locate the class constructor and decompile it. Constructors are named after the class (e.g., <code>OceanMonumentFeature::OceanMonumentFeature</code>).</li>
</ol>
<h3 id="useful-functions"><a class="header" href="#useful-functions">Useful Functions</a></h3>
<ul>
<li>
<p><strong>Jump to Xref</strong>:</p>
<ul>
<li>Right-click a function/type/variable and select <strong>Jump to Xref</strong> or <strong>Jump to Xref Globally</strong> to see where it’s used.</li>
</ul>
</li>
<li>
<p><strong>Generate C File</strong>:</p>
<ul>
<li>To export the entire disassembly as a C file: <strong>File</strong> &gt; <strong>Produce File</strong> &gt; <strong>Create C File</strong>. Note that this process is time-intensive.</li>
</ul>
</li>
<li>
<p><strong>Sync with [Window]</strong>:</p>
<ul>
<li>To modify a hardcoded value (e.g., piston push limit):
<ol>
<li>Right-click the value in the Hex View.</li>
<li>Select <strong>Synchronize With</strong> &gt; <strong>Hex View-[number]</strong>.</li>
<li>The corresponding section in the Hex View will be highlighted for easier navigation.</li>
</ol>
</li>
</ul>
</li>
</ul>
<h4 id="example-modifying-piston-push-limit"><a class="header" href="#example-modifying-piston-push-limit">Example: Modifying Piston Push Limit</a></h4>
<ul>
<li>In <code>PistonBlockActor::_checkAttachedBlocks</code> (81st line) and <code>PistonBlockActor::_attachedBlockWalker</code> (146th and 190th lines), replace the value <code>0xC</code> (12 in hexadecimal).</li>
<li>Alternatively, use this Python script to patch it automatically:</li>
</ul>
<hr />
<h3 id="outcrop"><a class="header" href="#outcrop">Outcrop</a></h3>
<p>Outcrop is straightforward to use. Check the <a href="https://github.com/">GitHub repository</a> for detailed instructions.</p>
<hr />
<h3 id="xenos"><a class="header" href="#xenos">Xenos</a></h3>
<ol>
<li>Download and run Xenos.</li>
<li>In the <strong>Process Selection</strong> section, select <strong>New</strong> and open the <code>bedrock_server.exe</code> file.</li>
<li>In the <strong>Images</strong> section, click <strong>Add</strong> and select the DLL file.</li>
<li>Click <strong>Inject</strong>.</li>
</ol>
<p><strong>Note</strong>: Windows Defender may flag Xenos as a false positive (e.g., <em>Vigram.A</em>). Options:</p>
<ul>
<li>Whitelist the file/folder.</li>
<li>Or, manually deal with Defender’s notifications each time.</li>
</ul>
<p><strong>Caution</strong>: Avoid whitelisting folders casually, as this can be exploited by malicious scripts to install malware.</p>
<hr />
<p>This guide emphasizes careful setup and navigation of tools essential for reverse engineering BDS, particularly using IDA Pro and Visual Studio, while ensuring security and stability during modifications.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->


                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">

            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->

        <script>
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>

    </div>
    </body>
</html>
